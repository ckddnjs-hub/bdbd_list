<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë³´ë™ë³´ë™ ë³´ë“œê²Œì„ ë¦¬ìŠ¤íŠ¸</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        body { background-color: #f8f9fa; font-family: 'Malgun Gothic', sans-serif; }
        .card { border: none; border-radius: 15px; transition: transform 0.2s; position: relative; }
        /* PCì—ì„œë§Œ ë§ˆìš°ìŠ¤ í˜¸ë²„ ì• ë‹ˆë©”ì´ì…˜ ì‘ë™ */
        @media (hover: hover) { 
            .card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important; } 
        }
        .card-title { font-weight: 800; color: #2c3e50; margin-right: 35px; word-break: keep-all; }
        .badge-genre { background-color: #6c5ce7; }
        .badge-diff { background-color: #fdcb6e; color: #2d3436; }
        .game-desc { font-size: 0.9rem; color: #636e72; min-height: 50px; }
        
        /* ìœ íŠœë¸Œ ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
        .yt-icon-link {
            position: absolute; top: 15px; right: 15px; color: #ff0000; font-size: 1.6rem;
            text-decoration: none; transition: color 0.2s; background: #fff; border-radius: 50%;
            width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .yt-icon-link:hover { color: #cc0000; }
        
        /* ëª¨ë°”ì¼ ìµœì í™” */
        .w-md-auto { width: 100%; }
        @media (min-width: 768px) { .w-md-auto { width: auto !important; } }
    </style>
</head>
<body>

<div class="container py-4 py-md-5">
    <div class="text-center mb-4">
        <h1 class="fw-bold mb-3 fs-2 fs-md-1">ğŸ² ë³´ë™ë³´ë™ ë³´ë“œê²Œì„</h1>
        <p class="text-muted small">êµ¬ê¸€ ì‹œíŠ¸ì™€ ì‹¤ì‹œê°„ ì—°ë™ëœ ìµœì‹  ëª©ë¡ì…ë‹ˆë‹¤.</p>
    </div>

    <div id="loading" class="text-center my-5">
        <div class="spinner-border text-primary" role="status"></div>
        <p class="mt-2 text-muted">ê²Œì„ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
    </div>

    <div id="controlsContainer" class="row mb-4" style="display: none;">
        <div class="col-12 col-md-5 mb-2 mb-md-0">
            <div class="input-group shadow-sm">
                <span class="input-group-text bg-white border-end-0"><i class="fas fa-search text-muted"></i></span>
                <input type="text" id="searchInput" class="form-control border-start-0 ps-0" placeholder="ê²Œì„ëª… ê²€ìƒ‰..." onkeyup="sortAndDisplayGames()">
            </div>
        </div>
        <div class="col-12 col-md-7 d-flex justify-content-md-end">
            <select class="form-select w-md-auto shadow-sm" id="sortSelect" onchange="sortAndDisplayGames()">
                <option value="name">ğŸ”  ê°€ë‚˜ë‹¤ìˆœ</option>
                <option value="diff_asc">ğŸŸ¢ ë‚œì´ë„ ì‰¬ìš´ìˆœ</option>
                <option value="diff_desc">ğŸ”´ ë‚œì´ë„ ì–´ë ¤ìš´ìˆœ</option>
                <option value="time_asc">â³ ì‹œê°„ ì§§ì€ìˆœ</option>
                <option value="time_desc">âŒ› ì‹œê°„ ê¸´ìˆœ</option>
                <option value="player_asc">ğŸ‘¤ ì¸ì› ì ì€ìˆœ</option>
                <option value="player_desc">ğŸ‘¥ ì¸ì› ë§ì€ìˆœ</option>
                <option value="pop_desc">â­ ì¸ê¸°ìˆœ</option>
            </select>
        </div>
    </div>

    <div id="noResult" class="text-center text-muted my-5" style="display: none;">
        <p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ğŸ˜¢</p>
    </div>

    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" id="gameGrid"></div>
</div>

<script>
    // ì‚¬ìš©ìë‹˜ì´ ë°œê¸‰ë°›ì€ êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì›¹ ê²Œì‹œ URL
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSHoZYMqS3T67UY2Tm6BRmlYNeVLVO_ZV2Rz72AY6fbknBn4l29avEykFoiFd3rrfm1BPnWjmj-HFMR/pubhtml?gid=976711259&single=true';
    
    let globalGames = [];

    // í˜ì´ì§€ ì ‘ì† ì‹œ ìë™ìœ¼ë¡œ êµ¬ê¸€ ì‹œíŠ¸ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´
    window.onload = function() {
        Papa.parse(sheetUrl, {
            download: true,
            header: true,
            complete: function(results) {
                // ê²Œì„ëª…ì´ ë¹„ì–´ìˆëŠ” ì˜ëª»ëœ ì¤„ ì œê±°
                globalGames = results.data.filter(game => game['ê²Œì„ëª…'] && game['ê²Œì„ëª…'].trim() !== '');
                
                // ë¡œë”© ìˆ¨ê¸°ê³  ì»¨íŠ¸ë¡¤ ë° ì¹´ë“œ í‘œì‹œ
                document.getElementById('loading').style.display = 'none';
                document.getElementById('controlsContainer').style.display = 'flex';
                sortAndDisplayGames();
            },
            error: function(err) {
                document.getElementById('loading').innerHTML = '<p class="text-danger">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. êµ¬ê¸€ ì‹œíŠ¸ ë§í¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>';
            }
        });
    };

    function calculateDifficulty(starString) {
        if (!starString) return 0;
        let score = 0;
        for (let char of starString) {
            if (char === 'â˜…') score += 1;
            else if (char === 'â˜†') score += 0.5;
        }
        return score;
    }

    function calculateTime(timeString) {
        if (!timeString) return 0;
        const numbers = timeString.match(/\d+/g);
        if (!numbers) return 0;
        let sum = 0;
        for (let num of numbers) sum += parseInt(num, 10);
        return sum / numbers.length; 
    }

    function calculatePlayers(playerString, isMax) {
        if (!playerString) return 0;
        const numbers = playerString.match(/\d+/g);
        if (!numbers || numbers.length === 0) return 0;
        if (isMax) return numbers.length > 1 ? parseInt(numbers[1], 10) : parseInt(numbers[0], 10);
        else return parseInt(numbers[0], 10);
    }

    function sortAndDisplayGames() {
        const sortOption = document.getElementById('sortSelect').value;
        const searchQuery = document.getElementById('searchInput').value.trim().toLowerCase();
        
        const grid = document.getElementById('gameGrid');
        const noResult = document.getElementById('noResult');
        grid.innerHTML = ''; 

        // 1. ê²€ìƒ‰ì–´ í•„í„°ë§
        let filteredGames = globalGames.filter(game => {
            const gameName = (game['ê²Œì„ëª…'] || '').toLowerCase();
            return gameName.includes(searchQuery);
        });

        // 2. ì •ë ¬
        filteredGames.sort((a, b) => {
            const nameA = a['ê²Œì„ëª…'] || ''; const nameB = b['ê²Œì„ëª…'] || '';

            if (sortOption === 'name') return nameA.localeCompare(nameB);
            else if (sortOption === 'diff_asc') {
                const valA = calculateDifficulty(a['ë‚œì´ë„']); const valB = calculateDifficulty(b['ë‚œì´ë„']);
                return valA === valB ? nameA.localeCompare(nameB) : valA - valB;
            } 
            else if (sortOption === 'diff_desc') {
                const valA = calculateDifficulty(a['ë‚œì´ë„']); const valB = calculateDifficulty(b['ë‚œì´ë„']);
                return valA === valB ? nameA.localeCompare(nameB) : valB - valA;
            }
            else if (sortOption === 'time_asc') {
                const valA = calculateTime(a['í”Œë ˆì´ ì‹œê°„']); const valB = calculateTime(b['í”Œë ˆì´ ì‹œê°„']);
                return valA === valB ? nameA.localeCompare(nameB) : valA - valB;
            }
            else if (sortOption === 'time_desc') {
                const valA = calculateTime(a['í”Œë ˆì´ ì‹œê°„']); const valB = calculateTime(b['í”Œë ˆì´ ì‹œê°„']);
                return valA === valB ? nameA.localeCompare(nameB) : valB - valA;
            }
            else if (sortOption === 'player_asc') {
                const valA = calculatePlayers(a['í”Œë ˆì´ ì¸ì›'], false); const valB = calculatePlayers(b['í”Œë ˆì´ ì¸ì›'], false);
                return valA === valB ? nameA.localeCompare(nameB) : valA - valB;
            }
            else if (sortOption === 'player_desc') {
                const valA = calculatePlayers(a['í”Œë ˆì´ ì¸ì›'], true); const valB = calculatePlayers(b['í”Œë ˆì´ ì¸ì›'], true);
                return valA === valB ? nameA.localeCompare(nameB) : valB - valA;
            }
            else if (sortOption === 'pop_desc') {
                const valA = parseFloat(a['ì¸ê¸°ë„'] || a['í‰ì '] || 0); const valB = parseFloat(b['ì¸ê¸°ë„'] || b['í‰ì '] || 0);
                return valA === valB ? nameA.localeCompare(nameB) : valB - valA;
            }
        });

        // 3. ë Œë”ë§
        if (filteredGames.length === 0 && globalGames.length > 0) {
            noResult.style.display = 'block';
        } else {
            noResult.style.display = 'none';
            filteredGames.forEach(game => {
                const youtubeLinkIcon = game['ê²Œì„ ê·œì¹™'] && game['ê²Œì„ ê·œì¹™'].includes('http') 
                    ? `<a href="${game['ê²Œì„ ê·œì¹™']}" target="_blank" class="yt-icon-link" title="ìœ íŠœë¸Œ ê·œì¹™ ì˜ìƒ ë³´ê¸°"><i class="fab fa-youtube"></i></a>` 
                    : '';

                const cardHTML = `
                    <div class="col">
                        <div class="card h-100 shadow-sm p-3">
                            ${youtubeLinkIcon}
                            <div class="card-body p-0">
                                <h4 class="card-title mb-3">${game['ê²Œì„ëª…'] || 'ì´ë¦„ ì—†ìŒ'}</h4>
                                <div class="mb-3">
                                    <span class="badge badge-genre me-1">${game['ì¥ë¥´'] || 'ì¥ë¥´ ë¯¸ìƒ'}</span>
                                    <span class="badge badge-diff">ë‚œì´ë„: ${game['ë‚œì´ë„'] || '-'}</span>
                                </div>
                                <ul class="list-unstyled mb-3">
                                    <li><strong>ğŸ‘¥ ì¸ì›:</strong> ${game['í”Œë ˆì´ ì¸ì›'] || '-'}</li>
                                    <li><strong>â³ ì‹œê°„:</strong> ${game['í”Œë ˆì´ ì‹œê°„'] || '-'}</li>
                                </ul>
                                <p class="card-text game-desc border-top pt-3">${game['ê²Œì„ ì„¤ëª…'] || ''}</p>
                            </div>
                        </div>
                    </div>
                `;
                grid.innerHTML += cardHTML;
            });
        }
    }
</script>

</body>
</html>
