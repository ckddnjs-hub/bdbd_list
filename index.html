<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³´ë™ë³´ë™ ë³´ë“œê²Œì„ ë¦¬ìŠ¤íŠ¸</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        body { background-color: #f8f9fa; font-family: 'Malgun Gothic', sans-serif; }
        .card { border: none; border-radius: 15px; transition: transform 0.2s; position: relative; overflow: hidden; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important; }
        .card-title { font-weight: 800; color: #2c3e50; padding-right: 40px; }
        .badge-genre { background-color: #6c5ce7; }
        .badge-diff { background-color: #fdcb6e; color: #2d3436; }
        .yt-link { position: absolute; top: 15px; right: 15px; color: #ff0000; font-size: 1.8rem; z-index: 10; }
        #loading { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 300px; }
    </style>
</head>
<body>

<div class="container py-5">
    <div class="text-center mb-5">
        <h1 class="fw-bold">ğŸ² ë³´ë™ë³´ë™ ë³´ë“œê²Œì„</h1>
        <p class="text-muted">ì‹¤ì‹œê°„ êµ¬ê¸€ ì‹œíŠ¸ ë°ì´í„° ì—°ë™ ì¤‘</p>
    </div>

    <div id="loading">
        <div class="spinner-border text-primary" role="status"></div>
        <p class="mt-3 text-muted">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...<br><small>(ì²˜ìŒ ë¡œë”© ì‹œ 2~3ì´ˆ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤)</small></p>
    </div>

    <div id="controls" class="row mb-4" style="display: none;">
        <div class="col-md-6 mb-3">
            <input type="text" id="searchInput" class="form-control" placeholder="ê²Œì„ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰..." onkeyup="renderGames()">
        </div>
        <div class="col-md-6 text-md-end">
            <select id="sortSelect" class="form-select w-auto d-inline-block" onchange="renderGames()">
                <option value="name">ê°€ë‚˜ë‹¤ìˆœ</option>
                <option value="diff_desc">ë‚œì´ë„ ë†’ì€ìˆœ</option>
                <option value="diff_asc">ë‚œì´ë„ ë‚®ì€ìˆœ</option>
            </select>
        </div>
    </div>

    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" id="gameGrid"></div>
</div>

<script>
    // 1. êµ¬ê¸€ ì‹œíŠ¸ CSV ì£¼ì†Œ (í”„ë¡ì‹œ ì„œë²„ë¥¼ ê²½ìœ í•˜ì—¬ CORS ë³´ì•ˆ ë¬¸ì œ í•´ê²°)
    const rawUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSHoZYMqS3T67UY2Tm6BRmlYNeVLVO_ZV2Rz72AY6fbknBn4l29avEykFoiFd3rrfm1BPnWjmj-HFMR/pub?output=csv';
    const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(rawUrl);

    let games = [];

    async function init() {
        try {
            // Fetchë¡œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
            const response = await fetch(proxyUrl);
            if (!response.ok) throw new Error('ë°ì´í„° ì‘ë‹µ ì—†ìŒ');
            const csvData = await response.text();

            // íŒŒì‹± ì‹œì‘
            Papa.parse(csvData, {
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    // êµ¬ê¸€ ì‹œíŠ¸ íŠ¹ì„±ìƒ í•„ë“œëª… ì•ë’¤ ê³µë°± ì œê±°
                    games = results.data.map(item => {
                        let obj = {};
                        for (let key in item) {
                            obj[key.trim()] = item[key] ? item[key].trim() : '';
                        }
                        return obj;
                    }).filter(g => g['ê²Œì„ëª…']); // ê²Œì„ëª…ì´ ìˆëŠ” ë°ì´í„°ë§Œ ì„ íƒ

                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('controls').style.display = 'flex';
                    renderGames();
                }
            });
        } catch (err) {
            console.error(err);
            document.getElementById('loading').innerHTML = `
                <div class="alert alert-danger">
                    ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨! <br> 
                    1. êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ [íŒŒì¼] -> [ê³µìœ ] -> [ì›¹ì— ê²Œì‹œ]ë¥¼ ì™„ë£Œí–ˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”. <br>
                    2. Vercelì— ë°°í¬í•œ í›„ í™•ì¸í•˜ì‹œë©´ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤.
                </div>`;
        }
    }

    function renderGames() {
        const query = document.getElementById('searchInput').value.toLowerCase();
        const sort = document.getElementById('sortSelect').value;
        const grid = document.getElementById('gameGrid');
        
        let filtered = games.filter(g => g['ê²Œì„ëª…'].toLowerCase().includes(query));

        // ì •ë ¬ ë¡œì§
        if (sort === 'name') filtered.sort((a, b) => a['ê²Œì„ëª…'].localeCompare(b['ê²Œì„ëª…']));
        if (sort.includes('diff')) {
            filtered.sort((a, b) => {
                const diffA = (a['ë‚œì´ë„'] || '').length;
                const diffB = (b['ë‚œì´ë„'] || '').length;
                return sort === 'diff_asc' ? diffA - diffB : diffB - diffA;
            });
        }

        grid.innerHTML = filtered.map(game => `
            <div class="col">
                <div class="card h-100 shadow-sm p-3">
                    ${game['ê²Œì„ ê·œì¹™'] ? `<a href="${game['ê²Œì„ ê·œì¹™']}" target="_blank" class="yt-link"><i class="fab fa-youtube"></i></a>` : ''}
                    <div class="card-body">
                        <h4 class="card-title mb-3">${game['ê²Œì„ëª…']}</h4>
                        <div class="mb-3">
                            <span class="badge badge-genre me-1">${game['ì¥ë¥´'] || 'ë³´ë“œê²Œì„'}</span>
                            <span class="badge badge-diff">ë‚œì´ë„: ${game['ë‚œì´ë„'] || '-'}</span>
                        </div>
                        <p class="small mb-1"><strong>ğŸ‘¤ ì¸ì›:</strong> ${game['í”Œë ˆì´ ì¸ì›'] || '-'}</p>
                        <p class="small mb-3"><strong>â³ ì‹œê°„:</strong> ${game['í”Œë ˆì´ ì‹œê°„'] || '-'}</p>
                        <hr>
                        <p class="card-text text-muted small">${game['ê²Œì„ ì„¤ëª…'] || 'ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.'}</p>
                    </div>
                </div>
            </div>
        `).join('');
    }

    init();
</script>
</body>
</html>
