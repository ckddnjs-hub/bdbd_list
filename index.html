<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³´ë™ë³´ë™ ë³´ë“œê²Œì„ ë¦¬ìŠ¤íŠ¸</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        body { background-color: #f8f9fa; font-family: 'Malgun Gothic', sans-serif; }
        .card { border: none; border-radius: 15px; transition: transform 0.2s; position: relative; height: 100%; border: 1px solid #eee; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important; }
        .card-title { font-weight: 800; color: #2c3e50; padding-right: 40px; word-break: keep-all; }
        .badge-genre { background-color: #6c5ce7; color: white; }
        .badge-diff { background-color: #fdcb6e; color: #2d3436; }
        .yt-link { position: absolute; top: 20px; right: 20px; color: #ff0000; font-size: 1.8rem; z-index: 10; transition: scale 0.2s; }
        .yt-link:hover { scale: 1.2; }
        .game-info { font-size: 0.9rem; margin-bottom: 4px; color: #444; }
        .game-desc { font-size: 0.85rem; color: #636e72; line-height: 1.5; }
        #loading { text-align: center; padding: 100px 0; }
    </style>
</head>
<body>

<div class="container py-4">
    <div class="text-center mb-5">
        <h1 class="fw-bold mb-2">ğŸ² ë³´ë™ë³´ë™ ë³´ë“œê²Œì„</h1>
        <p class="text-muted small">ë³´ìœ  ì¤‘ì¸ ë³´ë“œê²Œì„ ë¦¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤.</p>
    </div>

    <div id="loading">
        <div class="spinner-border text-primary" role="status"></div>
        <p class="mt-3 text-muted">ë°ì´í„°ë¥¼ ì½ì–´ì˜¤ëŠ” ì¤‘...</p>
    </div>

    <div id="controls" class="row mb-4 justify-content-center" style="display:none;">
        <div class="col-12 col-md-6">
            <div class="input-group shadow-sm">
                <span class="input-group-text bg-white border-end-0"><i class="fas fa-search"></i></span>
                <input type="text" id="searchInput" class="form-control border-start-0" placeholder="ê²Œì„ ì´ë¦„ ê²€ìƒ‰..." onkeyup="render()">
            </div>
        </div>
    </div>

    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" id="grid"></div>
</div>

<script>
    let games = [];

    // ê°™ì€ í´ë”ì˜ data.csvë¥¼ ì½ì–´ì˜¤ëŠ” í•¨ìˆ˜
    async function loadCSV() {
        try {
            const response = await fetch('data.csv');
            if (!response.ok) throw new Error('íŒŒì¼ ì—†ìŒ');
            
            const arrayBuffer = await response.arrayBuffer();
            const decoder = new TextDecoder('utf-8'); // í•œê¸€ ê¹¨ì§ ë°©ì§€
            const csvText = decoder.decode(arrayBuffer);

            Papa.parse(csvText, {
                header: false,
                skipEmptyLines: true,
                complete: function(results) {
                    processGameData(results.data);
                }
            });
        } catch (err) {
            document.getElementById('loading').innerHTML = 
                `<div class="alert alert-warning"><b>data.csv</b> íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. <br> 
                HTMLê³¼ ê°™ì€ í´ë”ì— CSV íŒŒì¼ì„ ë„£ì–´ì£¼ì„¸ìš”.</div>`;
        }
    }

    // ë³´ë™ë³´ë™ë‹˜ì˜ ì„¸ë¡œí˜• CSV êµ¬ì¡°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë¡œì§
    function processGameData(rows) {
        let list = [];
        let current = null;

        rows.forEach(row => {
            // row[1]ì€ í•­ëª© ì´ë¦„(ê²Œì„ëª… ë“±), row[2]ëŠ” ì‹¤ì œ ê°’
            const key = row[1] ? row[1].trim() : "";
            const value = row[2] ? row[2].trim() : "";

            if (key === "ê²Œì„ëª…") {
                if (current) list.push(current);
                current = { "ê²Œì„ëª…": value };
            } else if (current && key) {
                current[key] = value;
            }
        });
        if (current) list.push(current);

        games = list;
        document.getElementById('loading').style.display = 'none';
        document.getElementById('controls').style.display = 'flex';
        render();
    }

    function render() {
        const query = document.getElementById('searchInput').value.toLowerCase();
        const grid = document.getElementById('grid');
        
        const filtered = games.filter(g => g['ê²Œì„ëª…'] && g['ê²Œì„ëª…'].toLowerCase().includes(query));

        grid.innerHTML = filtered.map(g => `
            <div class="col">
                <div class="card shadow-sm p-4">
                    ${g['ê²Œì„ ê·œì¹™'] ? `<a href="${g['ê²Œì„ ê·œì¹™']}" target="_blank" class="yt-link"><i class="fab fa-youtube"></i></a>` : ''}
                    <div class="card-body p-0">
                        <h4 class="card-title mb-3">${g['ê²Œì„ëª…']}</h4>
                        <div class="mb-3">
                            <span class="badge badge-genre small me-1">${g['ì¥ë¥´'] || 'ë³´ë“œê²Œì„'}</span>
                            <span class="badge badge-diff small">ë‚œì´ë„: ${g['ë‚œì´ë„'] || '-'}</span>
                        </div>
                        <div class="game-info"><strong>ğŸ‘¥ ì¸ì›:</strong> ${g['í”Œë ˆì´ ì¸ì›'] || '-'}</div>
                        <div class="game-info"><strong>â³ ì‹œê°„:</strong> ${g['í”Œë ˆì´ ì‹œê°„'] || '-'}</div>
                        <p class="game-desc mt-3 border-top pt-3">${g['ê²Œì„ ì„¤ëª…'] || 'ìƒì„¸ ì„¤ëª… ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.'}</p>
                    </div>
                </div>
            </div>
        `).join('');
    }

    loadCSV();
</script>
</body>
</html>
