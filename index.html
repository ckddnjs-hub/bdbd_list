<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³´ë™ë³´ë™ ë³´ë“œê²Œì„ ë¦¬ìŠ¤íŠ¸</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        body { background-color: #f8f9fa; font-family: 'Malgun Gothic', sans-serif; }
        .card { border: none; border-radius: 15px; transition: transform 0.2s; position: relative; height: 100%; border: 1px solid #eee; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important; }
        .card-title { font-weight: 800; color: #2c3e50; padding-right: 40px; word-break: keep-all; font-size: 1.2rem; }
        .badge-genre { background-color: #6c5ce7; color: white; }
        .badge-diff { background-color: #fdcb6e; color: #2d3436; }
        .yt-link { position: absolute; top: 15px; right: 15px; color: #ff0000; font-size: 1.8rem; z-index: 10; }
        .game-info { font-size: 0.9rem; margin-bottom: 4px; color: #444; }
        .game-desc { font-size: 0.85rem; color: #636e72; line-height: 1.5; white-space: pre-wrap; }
        #loading { text-align: center; padding: 100px 0; }
    </style>
</head>
<body>

<div class="container py-4">
    <div class="text-center mb-5">
        <h1 class="fw-bold mb-2">ğŸ² ë³´ë™ë³´ë™ ë³´ë“œê²Œì„</h1>
        <p class="text-muted small">êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì‹¤ì‹œê°„ ì—°ë™ ëª¨ë“œ</p>
    </div>

    <div id="loading">
        <div class="spinner-border text-primary" role="status"></div>
        <p class="mt-3 text-muted">êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</p>
    </div>

    <div id="controls" class="row mb-4 justify-content-center" style="display:none;">
        <div class="col-12 col-md-6">
            <div class="input-group shadow-sm">
                <span class="input-group-text bg-white border-end-0"><i class="fas fa-search"></i></span>
                <input type="text" id="searchInput" class="form-control border-start-0" placeholder="ê²Œì„ ì´ë¦„ ê²€ìƒ‰..." onkeyup="render()">
            </div>
        </div>
    </div>

    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" id="grid"></div>
</div>

<script>
    // 1. ì‚¬ìš©ìë‹˜ì˜ ì‹œíŠ¸ë¥¼ CSV í˜•ì‹ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¤ëŠ” ì£¼ì†Œ (pubhtml -> pub?output=csv ë¡œ ë³€ê²½)
    const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTvIiEm0p5T4uYzp56LpTT0eDnUhlsuzJESXSuY9Ur_oQkMzoitt4u9zFSCgHqpE72iuqmg3QxD7Vy7/pub?gid=0&single=true&output=csv';

    let games = [];

    async function loadData() {
        try {
            // CORS ë¬¸ì œë¥¼ í”¼í•˜ê¸° ìœ„í•´ AllOrigins í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
            const response = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(SHEET_URL)}`);
            if (!response.ok) throw new Error('ë„¤íŠ¸ì›Œí¬ ì‘ë‹µì´ ì—†ìŠµë‹ˆë‹¤.');
            
            const csvText = await response.text();

            Papa.parse(csvText, {
                skipEmptyLines: true,
                complete: function(results) {
                    transformData(results.data);
                }
            });
        } catch (err) {
            console.error(err);
            document.getElementById('loading').innerHTML = `
                <div class="alert alert-danger">
                    ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨! <br>
                    êµ¬ê¸€ ì‹œíŠ¸ê°€ <b>[ì›¹ì— ê²Œì‹œ]</b> ìƒíƒœì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.
                </div>`;
        }
    }

    // ì„¸ë¡œí˜• ë°ì´í„°ë¥¼ ì›¹ì‚¬ì´íŠ¸ìš© êµ¬ì¡°(JSON)ë¡œ ë³€í™˜
    function transformData(rawData) {
        let tempGames = [];
        let currentItem = null;

        rawData.forEach(row => {
            // êµ¬ê¸€ ì‹œíŠ¸ êµ¬ì¡°ìƒ Bì—´(index 1)ì´ í•­ëª©ëª…, Cì—´(index 2)ì´ ë‚´ìš©
            const key = row[1] ? row[1].trim() : "";
            const value = row[2] ? row[2].trim() : "";

            if (key === "ê²Œì„ëª…") {
                if (currentItem) tempGames.push(currentItem);
                currentItem = { "ê²Œì„ëª…": value };
            } else if (currentItem && key) {
                currentItem[key] = value;
            }
        });
        if (currentItem) tempGames.push(currentItem);

        games = tempGames;
        document.getElementById('loading').style.display = 'none';
        document.getElementById('controls').style.display = 'flex';
        render();
    }

    function render() {
        const query = document.getElementById('searchInput').value.toLowerCase();
        const grid = document.getElementById('grid');
        const filtered = games.filter(g => g['ê²Œì„ëª…'] && g['ê²Œì„ëª…'].toLowerCase().includes(query));

        if (filtered.length === 0) {
            grid.innerHTML = '<div class="col-12 text-center mt-5 text-muted">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            return;
        }

        grid.innerHTML = filtered.map(g => `
            <div class="col">
                <div class="card shadow-sm p-4">
                    ${g['ê²Œì„ ê·œì¹™'] && g['ê²Œì„ ê·œì¹™'].startsWith('http') ? `<a href="${g['ê²Œì„ ê·œì¹™']}" target="_blank" class="yt-link"><i class="fab fa-youtube"></i></a>` : ''}
                    <div class="card-body p-0">
                        <h4 class="card-title mb-3">${g['ê²Œì„ëª…']}</h4>
                        <div class="mb-3">
                            <span class="badge badge-genre small me-1">${g['ì¥ë¥´'] || 'ì¥ë¥´ë¯¸ìƒ'}</span>
                            <span class="badge badge-diff small">ë‚œì´ë„: ${g['ë‚œì´ë„'] || '-'}</span>
                        </div>
                        <div class="game-info"><strong>ğŸ‘¥ ì¸ì›:</strong> ${g['í”Œë ˆì´ ì¸ì›'] || '-'}</div>
                        <div class="game-info"><strong>â³ ì‹œê°„:</strong> ${g['í”Œë ˆì´ ì‹œê°„'] || '-'}</div>
                        <p class="game-desc mt-3 border-top pt-3">${g['ê²Œì„ ì„¤ëª…'] || ''}</p>
                    </div>
                </div>
            </div>
        `).join('');
    }

    loadData();
</script>
</body>
</html>
